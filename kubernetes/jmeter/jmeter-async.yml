apiVersion: batch/v1
kind: Job
metadata:
  name: async-jmeter
  labels:
    app: async-jmeter
spec:
  template:
    metadata:
      name: async-jmeter
    spec:
      containers:
        - image: gcr.io/reactive-test/rvss-jmeter:latest
          name: async-jmeter
          env:
          - name: SERVER_HOST
            value: %%SERVER_HOST%%
          - name: NUM_THREADS
            value: "4000"
          - name: RAMPUP_PERIOD
            value: "360"
          - name: LOOP_COUNT
            value: "50"
          - name: OUT_DIR
            value: "out/async/report"
          - name: OUT_RESULTS
            value: "out/async/results.csv"
          volumeMounts:
          - mountPath: /jmeter/out
            name: jmeter-async-volume
      restartPolicy: Never
      volumes:
      - name: jmeter-async-volume
        gcePersistentDisk:
          pdName: jmeter-async
          fsType: ext4
